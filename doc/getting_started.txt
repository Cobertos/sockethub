# 1. Install
make sure you followed the [install instructions](install.txt)

# 2. Connect
Your unhosted web app will have to connect to the user's sockethub instance.
This is done via a WebSocket. you have to get the host and port from the user (default is ws://localhost:10550/),
and one of the secrets they configured in their config.secrets.js file (defaults are 1234567890 and 0987654321).

Once you got these details from the user, try to open a WebSocket to the host and port, path '/', protocol 'sockethub':
````js
    var sock = new WebSocket('ws://localhost:10550/', 'sockethub');
````
# 3. Send register command
The first thing your app has to send once the socket is open is a 'register' command:
````js
var secret;//make sure this variable is available to the sock.onopen handler from parent scope
sock.onopen = function() {
  sock.send(JSON.stringify({
    platform: 'dispatcher',
    verb: 'register',
    object: {
      secret: secret
    },
    rid: new Date().getTime()
  }));
};
````
# 4. Receive response
````js
sock.onmessage = function(e) {
  var data;
  try {
    data = JSON.parse(e.data);
  } catch(err) {
    console.log('bogus message: '+e.data);
    return;
  }
  console.log('[sockethub IN]', JSON.stringify(data));
  if(data.verb == 'confirm') {
    return;
  }
  if(data.rid && data.rid == registerRid && data.verb == 'register') {
     if(data.status) {
       console.log('register successful');
    } else {
      console.error(data.message);
    }
  } else {
    console.log(data);
  }
};
````
# 5. Deal with lost connections
Sometimes, the sockethub server will restart, and you want your app to reconnect if that happens.
Put all the previous code (setting the sock variable, and assigning its event handlers) into a function
called 'connect', and then (also inside that 'connect' function), add an onclose handler:
````js
sock.onclose = function() {
  if(secret) {//again, make sure this variable is avaiable in the parent scope
    connect();
  } else {
    //will also happen if connection was refused or timed out:
    handler.error('could not connect to the sockethub server on '+host);
  }
}
````
